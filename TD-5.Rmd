---
title: "Travaux Dirigées ("
author: "Groupe 1"
date: "2025-09-25"
output: html_document
---

### Travaux Dirigeées 5

Voici notre tramr de données :

```{r}
library(infer)  
library(tidyverse)
us_adults <- data.frame(climate_change_affects = c(rep("Yes", 62000), rep("No", 38000)) )
```

#### EXERCICE.1

```{r}
set.seed(123) 
samp <- us_adults %>%      
  slice_sample(n = 100) 
true_p <- mean(us_adults$climate_change_affects == "Yes")
true_p 
samp %>%
  specify(response = climate_change_affects, success = "Yes") %>%
  generate(reps = 1000, type = "bootstrap") %>%
  calculate(stat = "prop") %>%
  get_ci(level = 0.99)
```

Plus le niveau de confiance est grand (ex. 99%), plus l'intervalle est large car on veut être "plus sûr que la vraie valeur est dedans.

### EXERCICE.2

```{r}
ic_90 <- samp %>%
  specify(response = climate_change_affects, success = "Yes") %>%  
  generate(reps = 1000, type = "bootstrap") %>%  
  calculate(stat = "prop") %>%  
  get_confidence_interval(level = 0.90, type = "percentile")

ic_90
```

Interprétation : nous sommes 90% confiants que la vraie proportion est comprise entre ic_90$lower_ci et ic_90$upper_ci.

### EXERCICE.3

```{r}
n_iter <- 50  
results <- matrix(NA, nrow = n_iter, ncol = 2)  
for (i in 1:n_iter) {
  
  samp2 <- samp %>% slice_sample(n = nrow(samp), replace = TRUE)
  
  ci <- samp2 %>%
    specify(response = climate_change_affects, success = "Yes") %>%
    generate(reps = 1000, type = "bootstrap") %>%
    calculate(stat = "prop") %>%
    get_ci(level = 0.90)
  
  results[i, ] <- c(ci$lower_ci, ci$upper_ci)
}

colnames(results) <- c("Lower", "Upper")

coverage <- mean(results[,1] <= true_p & results[,2] >= true_p)
coverage  

plot(1:n_iter, rowMeans(results), ylim = c(0.5, 0.7), pch = 16,
     xlab = "Intervalle", ylab = "Proportion estimée",
     main = "50 intervalles de confiance à 90%")
segments(1:n_iter, results[,1], 1:n_iter, results[,2])  
abline(h = true_p, col = "red", lwd = 2)  
```

### EXERCICE.4

```{r}
ic_99 <- samp %>%
  specify(response = climate_change_affects, success = "Yes") %>%
  generate(reps = 1000, type = "bootstrap") %>%
  calculate(stat = "prop") %>%
  get_ci(level = 0.99, type = "percentile")
ic_99

results_99 <- matrix(NA, nrow = n_iter, ncol = 2)
for (i in 1:n_iter) {
  samp2 <- samp %>% 
    slice_sample(n = nrow(samp), replace = TRUE)
  ci <- samp2 %>%
    specify(response = climate_change_affects, success = "Yes") %>%
    generate(reps = 1000, type = "bootstrap") %>%
    calculate(stat = "prop") %>%
    get_confidence_interval(level = 0.99, type = "percentile")
  results_99[i, ] <- c(ci$lower_ci, ci$upper_ci)
}
coverage_99 <- mean(results_99[,1] <= true_p & results_99[,2] >= true_p)
coverage_99
```

### EXERCICE.5

```{r}
sizes <- c(30, 60, 120, 500)
for (n in sizes) {
  samp2 <- us_adults %>% slice_sample(n = n)
  ci <- samp2 %>%
    specify(response = climate_change_affects, success = "Yes") %>%
    generate(reps = 1000, type = "bootstrap") %>%
    calculate(stat = "prop") %>%
    get_confidence_interval(level = 0.95, type = "percentile")
  print(paste("Taille d'échantillon =", n, 
              "IC 95% =", round(ci$lower_ci,3), "à", round(ci$upper_ci,3)))
}

```

Observation : plus l'échantillon est grand, plus l'IC est étroit.

### EXERCICE.6

```{r}
samp_60 <- us_adults %>%
  slice_sample(n = 60)


ci_500 <- samp_60 %>%
  specify(response = climate_change_affects, success = "Yes") %>%
  generate(reps = 500, type = "bootstrap") %>%
  calculate(stat = "prop") %>%
  get_ci(level = 0.95, type = "percentile")
ci_500


ci_5000 <- samp_60 %>%
  specify(response = climate_change_affects, success = "Yes") %>%
  generate(reps = 5000, type = "bootstrap") %>%
  calculate(stat = "prop") %>%
  get_ci(level = 0.95, type = "percentile")
ci_5000
```

Observation : la largeur de l'IC change très peu, mais l'estimation devient plus stable.
